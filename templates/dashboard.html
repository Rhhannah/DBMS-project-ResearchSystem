{% extends "layout.html" %}

{% block content %}
<h3 class="mb-4 border-bottom pb-2">系统仪表盘</h3>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card-counter primary cursor-pointer">
            <i class="bi bi-list-check fs-1 float-start"></i>
            <div class="float-end text-end">
                <span class="fs-2">{{ active_tasks }}</span>
                <p>进行中的任务</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card-counter danger">
            <i class="bi bi-exclamation-circle fs-1 float-start"></i>
            <div class="float-end text-end">
                <span class="fs-2">{{ task_stats.active }}</span>
                <p>待处理提醒</p>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <h5 class="card-title mb-3">快捷操作</h5>
        <a href="{{ url_for('task_center') }}" class="btn btn-primary btn-lg me-2">
            <i class="bi bi-plus-circle"></i> 发起新的数据收集任务
        </a>
        <a href="{{ url_for('contacts') }}" class="btn btn-outline-secondary">
            <i class="bi bi-person-lines-fill"></i> 管理通讯录
        </a>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-white">
        <h5 class="mb-0">最近任务动态</h5>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr><th>任务名称</th><th>状态</th><th>截止时间</th></tr>
            </thead>
            <tbody>
                {% for task in recent_tasks %}
                <tr>
                    <td>{{ task.task_name }}</td>
                    <td>
                        {% if task.status == 'active' %}
                            <span class="badge bg-success">进行中</span>
                        {% elif task.status == 'draft' %}
                            <span class="badge bg-warning text-dark">草稿</span>
                        {% else %}
                            <span class="badge bg-secondary">已结束</span>
                        {% endif %}
                    </td>
                    <td>{{ task.end_time.strftime('%Y-%m-%d') if task.end_time else '未设置' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center text-muted">暂无任务</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}